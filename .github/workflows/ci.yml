name: CI

on:
  push:
    branches: [ "main", "beta" ]
  pull_request:
    branches: [ "main", "beta" ]

jobs:
  ci:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Set up Ruby
        uses: ruby/setup-ruby@v1
        with:
          ruby-version: "3.2.3"
          bundler-cache: true

      # -----------------------------------------
      # RUBOCOP (Lint)
      # -----------------------------------------
      - name: Run RuboCop
        run: |
          if bundle exec rubocop --version > /dev/null 2>&1; then
            echo "Running RuboCop..."
            bundle exec rubocop || true
          else
            echo "Rubocop not installed. Skipping."
          fi

      # -----------------------------------------
      # BRAKEMAN (Security)
      # -----------------------------------------
      - name: Run Brakeman (Security)
        run: |
          if bundle exec brakeman --version > /dev/null 2>&1; then
            echo "Running Brakeman..."
            bundle exec brakeman -q --summary || true
          else
            echo "Brakeman not installed. Skipping."
          fi

      # -----------------------------------------
      # TESTS (quando vocÃª criar specs)
      # -----------------------------------------
      - name: Run Test Suite
        run: |
          if [ -d "spec" ] || [ -d "test" ]; then
            echo "Running tests..."
            bundle exec rake || true
          else
            echo "No tests folder found. Skipping."
          fi
